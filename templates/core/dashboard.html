{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Dashboard - SafeRelease Nigeria{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-600) 100%);
        color: white;
        padding: 2.5rem 0;
        margin-bottom: 2rem;
        border-radius: 0 0 var(--radius-2xl) var(--radius-2xl);
        position: relative;
        overflow: hidden;
    }
    
    .dashboard-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 50%, rgba(0, 200, 83, 0.1) 0%, transparent 50%);
    }
    
    .dashboard-header-content {
        position: relative;
        z-index: 2;
    }
    
    .dashboard-title {
        font-size: 2.25rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
    }
    
    .dashboard-subtitle {
        font-size: 1.125rem;
        color: rgba(255, 255, 255, 0.9);
    }
    
    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card-modern {
        background: white;
        border-radius: var(--radius-xl);
        padding: 2rem;
        box-shadow: var(--shadow-lg);
        border: 2px solid var(--neutral-200);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        transition: width 0.3s ease;
    }
    
    .stat-card-modern:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-2xl);
    }
    
    .stat-card-modern:hover::before {
        width: 8px;
    }
    
    .stat-card-primary::before {
        background: linear-gradient(180deg, var(--primary-600) 0%, var(--primary-700) 100%);
    }
    
    .stat-card-warning::before {
        background: linear-gradient(180deg, var(--warning-500) 0%, var(--warning-600) 100%);
    }
    
    .stat-card-success::before {
        background: linear-gradient(180deg, var(--accent-500) 0%, var(--accent-600) 100%);
    }
    
    .stat-card-info::before {
        background: linear-gradient(180deg, #7C4DFF 0%, #5E35B1 100%);
    }
    
    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-lg);
        font-size: 1.5rem;
    }
    
    .stat-icon-primary {
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(21, 101, 192, 0.1) 100%);
        color: var(--primary-700);
    }
    
    .stat-icon-warning {
        background: linear-gradient(135deg, rgba(245, 124, 0, 0.1) 0%, rgba(255, 152, 0, 0.1) 100%);
        color: var(--warning-600);
    }
    
    .stat-icon-success {
        background: linear-gradient(135deg, rgba(0, 200, 83, 0.1) 0%, rgba(0, 191, 165, 0.1) 100%);
        color: var(--accent-600);
    }
    
    .stat-icon-info {
        background: linear-gradient(135deg, rgba(124, 77, 255, 0.1) 0%, rgba(103, 58, 183, 0.1) 100%);
        color: #7C4DFF;
    }
    
    .stat-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--neutral-600);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
    }
    
    .stat-value-large {
        font-size: 2rem;
        font-weight: 800;
        color: var(--neutral-900);
        font-family: var(--font-display);
        margin-bottom: 0.25rem;
    }
    
    .stat-description {
        font-size: 0.875rem;
        color: var(--neutral-600);
    }
    
    /* Quick Actions */
    .quick-actions {
        background: white;
        border-radius: var(--radius-xl);
        padding: 2rem;
        box-shadow: var(--shadow-lg);
        border: 2px solid var(--neutral-200);
        margin-bottom: 2rem;
    }
    
    .quick-actions-title {
        font-size: 1.375rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--neutral-900);
    }
    
    .action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    /* Action Required Alert */
    .action-alert {
        background: linear-gradient(135deg, rgba(245, 124, 0, 0.1) 0%, rgba(255, 152, 0, 0.05) 100%);
        border: 2px solid var(--warning-400);
        border-radius: var(--radius-xl);
        padding: 1.75rem;
        margin-bottom: 2rem;
    }
    
    .action-alert-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .action-alert-icon {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--warning-500);
        color: white;
        border-radius: var(--radius-lg);
        font-size: 1.5rem;
        flex-shrink: 0;
    }
    
    .action-alert-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--neutral-900);
        margin: 0;
    }
    
    .action-alert-items {
        padding-left: 0;
        margin: 0;
        list-style: none;
    }
    
    .action-alert-items li {
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(245, 124, 0, 0.2);
    }
    
    .action-alert-items li:last-child {
        border-bottom: none;
    }
    
    .action-alert-items strong {
        color: var(--warning-700);
    }
    
    .action-alert-items a {
        color: var(--primary-700);
        font-weight: 600;
        text-decoration: none;
        transition: color var(--transition-base);
    }
    
    .action-alert-items a:hover {
        color: var(--primary-600);
        text-decoration: underline;
    }
    
    /* Transactions Table */
    .transactions-section {
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        border: 2px solid var(--neutral-200);
        overflow: hidden;
    }
    
    .section-header {
        padding: 1.75rem 2rem;
        border-bottom: 2px solid var(--neutral-200);
        background: linear-gradient(135deg, var(--neutral-50) 0%, white 100%);
    }
    
    .section-title {
        font-size: 1.375rem;
        font-weight: 700;
        color: var(--neutral-900);
        margin: 0;
    }
    
    .transactions-table-wrapper {
        overflow-x: auto;
    }
    
    .transactions-table {
        width: 100%;
        margin: 0;
    }
    
    .transactions-table th {
        background: var(--neutral-50);
        padding: 1.25rem 1.5rem;
        font-weight: 700;
        font-size: 0.875rem;
        color: var(--neutral-700);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-bottom: 2px solid var(--neutral-200);
    }
    
    .transactions-table td {
        padding: 1.5rem 1.5rem;
        border-bottom: 1px solid var(--neutral-200);
        font-size: 0.9375rem;
    }
    
    .transactions-table tr:last-child td {
        border-bottom: none;
    }
    
    .transactions-table tr:hover {
        background: var(--neutral-50);
    }
    
    .party-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-md);
        font-size: 0.8125rem;
        font-weight: 700;
        margin-bottom: 0.375rem;
    }
    
    .party-badge-client {
        background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(21, 101, 192, 0.1) 100%);
        color: var(--primary-700);
        border: 1px solid var(--primary-400);
    }
    
    .party-badge-provider {
        background: linear-gradient(135deg, rgba(0, 200, 83, 0.1) 0%, rgba(0, 191, 165, 0.1) 100%);
        color: var(--accent-600);
        border: 1px solid var(--accent-400);
    }
    
    .amount-highlight {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--neutral-900);
        font-family: var(--font-display);
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }
    
    .empty-icon {
        font-size: 5rem;
        color: var(--neutral-400);
        margin-bottom: 1.5rem;
    }
    
    .empty-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--neutral-900);
        margin-bottom: 0.75rem;
    }
    
    .empty-description {
        color: var(--neutral-600);
        margin-bottom: 2rem;
        font-size: 1.0625rem;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
        }
        
        .dashboard-title {
            font-size: 1.875rem;
        }
    }
    
    @media (max-width: 768px) {
        .dashboard-header {
            padding: 1.75rem 0;
        }
        
        .dashboard-title {
            font-size: 1.5rem;
        }
        
        .stat-value-large {
            font-size: 1.75rem;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .action-buttons .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="dashboard-header">
    <div class="container">
        <div class="dashboard-header-content fade-in-up">
            <h1 class="dashboard-title">
                Welcome back, {{ user.first_name }}! 
                <i class="bi bi-emoji-smile"></i>
            </h1>
            <p class="dashboard-subtitle">
                Here's what's happening with your transactions
            </p>
        </div>
    </div>
</div>

<div class="container pb-5">
    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card-modern stat-card-primary">
            <div class="stat-header">
                <div>
                    <div class="stat-label">Wallet Balance</div>
                    <div class="stat-value-large">₦{{ stats.wallet_balance|floatformat:2|intcomma }}</div>
                    <div class="stat-description">Available to withdraw</div>
                </div>
                <div class="stat-icon stat-icon-primary">
                    <i class="bi bi-wallet2"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card-modern stat-card-warning">
            <div class="stat-header">
                <div>
                    <div class="stat-label">In Escrow</div>
                    <div class="stat-value-large">₦{{ stats.escrow_balance|floatformat:2|intcomma }}</div>
                    <div class="stat-description">Held securely</div>
                </div>
                <div class="stat-icon stat-icon-warning">
                    <i class="bi bi-shield-lock"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card-modern stat-card-success">
            <div class="stat-header">
                <div>
                    <div class="stat-label">Total Earned</div>
                    <div class="stat-value-large">₦{{ stats.total_earned|floatformat:2|intcomma }}</div>
                    <div class="stat-description">Lifetime earnings</div>
                </div>
                <div class="stat-icon stat-icon-success">
                    <i class="bi bi-graph-up-arrow"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card-modern stat-card-info">
            <div class="stat-header">
                <div>
                    <div class="stat-label">Transactions</div>
                    <div class="stat-value-large">{{ stats.total_transactions }}</div>
                    <div class="stat-description">{{ stats.active_transactions }} active</div>
                </div>
                <div class="stat-icon stat-icon-info">
                    <i class="bi bi-arrow-left-right"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions fade-in-up">
        <h2 class="quick-actions-title">
            <i class="bi bi-lightning-charge-fill me-2" style="color: var(--accent-600);"></i>
            Quick Actions
        </h2>
        <div class="action-buttons">
            <a href="{% url 'transactions:create' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle me-2"></i>
                New Transaction
            </a>
            <a href="{% url 'transactions:my_transactions' %}" class="btn btn-outline-primary btn-lg">
                <i class="bi bi-list-ul me-2"></i>
                View All Transactions
            </a>
            <a href="{% url 'accounts:profile' %}" class="btn btn-outline-secondary btn-lg">
                <i class="bi bi-person me-2"></i>
                My Profile
            </a>
        </div>
    </div>
    
    <!-- Action Required -->
    {% if pending_approvals or pending_work %}
    <div class="action-alert fade-in-up">
        <div class="action-alert-header">
            <div class="action-alert-icon">
                <i class="bi bi-exclamation-triangle-fill"></i>
            </div>
            <h3 class="action-alert-title">Action Required</h3>
        </div>
        <ul class="action-alert-items">
            {% if pending_approvals %}
            <li>
                <strong>{{ pending_approvals }}</strong> transaction{{ pending_approvals|pluralize }} waiting for your approval.
                <a href="{% url 'transactions:my_transactions' %}?filter=as_client&status=COMPLETED">Review now →</a>
            </li>
            {% endif %}
            {% if pending_work %}
            <li>
                <strong>{{ pending_work }}</strong> job{{ pending_work|pluralize }} waiting for you to complete.
                <a href="{% url 'transactions:my_transactions' %}?filter=as_provider&status=IN_PROGRESS">View jobs →</a>
            </li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
    
    <!-- Recent Transactions -->
    <div class="transactions-section fade-in-up">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-clock-history me-2" style="color: var(--primary-600);"></i>
                Recent Transactions
            </h2>
        </div>
        
        {% if recent_transactions %}
        <div class="transactions-table-wrapper">
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Reference</th>
                        <th>Party</th>
                        <th>Amount</th>
                        <th>Service</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for txn in recent_transactions %}
                    <tr>
                        <td>
                            <strong style="font-family: var(--font-display);">{{ txn.reference }}</strong>
                        </td>
                        <td>
                            {% if txn.client == user %}
                                <span class="party-badge party-badge-client">
                                    <i class="bi bi-person-fill"></i> You (Client)
                                </span><br>
                                <small style="color: var(--neutral-600);">Provider: {{ txn.service_provider.get_full_name }}</small>
                            {% else %}
                                <span class="party-badge party-badge-provider">
                                    <i class="bi bi-briefcase-fill"></i> You (Provider)
                                </span><br>
                                <small style="color: var(--neutral-600);">Client: {{ txn.client.get_full_name }}</small>
                            {% endif %}
                        </td>
                        <td>
                            <span class="amount-highlight">₦{{ txn.amount|floatformat:2|intcomma }}</span>
                        </td>
                        <td>
                            <div>{{ txn.service_description|truncatewords:5 }}</div>
                            {% if txn.service_category %}
                                <small style="color: var(--neutral-500);">{{ txn.service_category }}</small>
                            {% endif %}
                        </td>
                        <td>
                            <span class="status-badge status-{{ txn.status|lower }}">
                                {{ txn.get_status_display }}
                            </span>
                        </td>
                        <td>
                            <div>{{ txn.created_at|date:"M d, Y" }}</div>
                            <small style="color: var(--neutral-500);">{{ txn.created_at|date:"h:i A" }}</small>
                        </td>
                        <td>
                            <a href="{% url 'transactions:detail' txn.id %}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-eye me-1"></i> View
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <i class="bi bi-inbox empty-icon"></i>
            <h3 class="empty-title">No transactions yet</h3>
            <p class="empty-description">Start by creating your first secure transaction</p>
            <a href="{% url 'transactions:create' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle me-2"></i>
                Create Your First Transaction
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}